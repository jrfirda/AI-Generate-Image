<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LALUNA Studio AI - Profesional Visual Generator</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        body { font-family: 'Plus Jakarta Sans', sans-serif; }
        [x-cloak] { display: none !important; }
        .glass-effect { background: rgba(255, 255, 255, 0.8); backdrop-filter: blur(12px); }
        .bg-mesh {
            background-color: #f8fafd;
            background-image: radial-gradient(at 0% 0%, rgba(66, 133, 244, 0.05) 0px, transparent 50%),
                              radial-gradient(at 100% 100%, rgba(155, 114, 243, 0.05) 0px, transparent 50%);
        }
    </style>
</head>
<body class="bg-mesh text-[#1F1F1F]" x-data="app()" x-init="init()" x-cloak>
    
    <!-- API Key Setup Overlay -->
    <template x-if="!apiKeyConfigured">
        <div class="fixed inset-0 z-[100] flex items-center justify-center bg-black/60 backdrop-blur-md p-6">
            <div class="bg-white rounded-[40px] p-8 md:p-10 max-w-md w-full shadow-2xl space-y-8 animate-in zoom-in duration-300">
                <div class="text-center space-y-3">
                    <!-- Google Logo -->
                    <div class="flex justify-center mb-6">
                        <svg class="w-12 h-12" viewBox="0 0 48 48">
                            <path fill="#EA4335" d="M24 9.5c3.54 0 6.71 1.22 9.21 3.6l6.85-6.85C35.9 2.38 30.47 0 24 0 14.62 0 6.51 5.38 2.56 13.22l7.98 6.19C12.43 13.72 17.74 9.5 24 9.5z"></path>
                            <path fill="#4285F4" d="M46.98 24.55c0-1.57-.15-3.09-.38-4.55H24v9.02h12.94c-.58 2.96-2.26 5.48-4.78 7.18l7.73 6c4.51-4.18 7.09-10.36 7.09-17.65z"></path>
                            <path fill="#FBBC05" d="M10.53 28.59c-.48-1.45-.76-2.99-.76-4.59s.27-3.14.76-4.59l-7.98-6.19C.92 16.46 0 20.12 0 24s.92 7.54 2.56 10.78l7.97-6.19z"></path>
                            <path fill="#34A853" d="M24 48c6.48 0 11.93-2.13 15.89-5.81l-7.73-6c-2.15 1.45-4.92 2.3-8.16 2.3-6.26 0-11.57-4.22-13.47-9.91l-7.98 6.19C6.51 42.62 14.62 48 24 48z"></path>
                            <path fill="none" d="M0 0h48v48H0z"></path>
                        </svg>
                    </div>
                    <h2 class="text-3xl font-extrabold tracking-tight">Akses Studio AI</h2>
                    <p class="text-gray-500 text-sm leading-relaxed">Gunakan Google Gemini API Key Anda untuk mulai menghasilkan visual sinematik.</p>
                </div>

                <div class="space-y-4">
                    <div class="space-y-2">
                        <label class="text-[10px] font-bold text-gray-400 uppercase tracking-[0.2em] ml-1">Kunci API Google AI</label>
                        <input 
                            type="password" 
                            x-model="tempKey" 
                            placeholder="Masukkan API Key (AIza...)" 
                            class="w-full px-6 py-4 bg-gray-50 border border-gray-200 rounded-2xl focus:ring-2 focus:ring-indigo-500 outline-none transition-all font-mono text-sm"
                        >
                    </div>

                    <div class="flex flex-col gap-3">
                        <button 
                            @click="saveKey"
                            class="w-full py-4 bg-[#1F1F1F] text-white rounded-2xl font-bold hover:bg-black transition-all shadow-lg active:scale-[0.98]"
                        >
                            Konfigurasi & Hubungkan
                        </button>
                        
                        <a 
                            href="https://aistudio.google.com/app/apikey" 
                            target="_blank"
                            class="w-full py-4 bg-white text-gray-700 rounded-2xl font-bold hover:bg-gray-50 transition-all flex items-center justify-center gap-2 text-sm border border-gray-200"
                        >
                            <svg class="w-4 h-4" viewBox="0 0 48 48">
                                <path fill="#EA4335" d="M24 9.5c3.54 0 6.71 1.22 9.21 3.6l6.85-6.85C35.9 2.38 30.47 0 24 0 14.62 0 6.51 5.38 2.56 13.22l7.98 6.19C12.43 13.72 17.74 9.5 24 9.5z"></path>
                                <path fill="#4285F4" d="M46.98 24.55c0-1.57-.15-3.09-.38-4.55H24v9.02h12.94c-.58 2.96-2.26 5.48-4.78 7.18l7.73 6c4.51-4.18 7.09-10.36 7.09-17.65z"></path>
                                <path fill="#FBBC05" d="M10.53 28.59c-.48-1.45-.76-2.99-.76-4.59s.27-3.14.76-4.59l-7.98-6.19C.92 16.46 0 20.12 0 24s.92 7.54 2.56 10.78l7.97-6.19z"></path>
                                <path fill="#34A853" d="M24 48c6.48 0 11.93-2.13 15.89-5.81l-7.73-6c-2.15 1.45-4.92 2.3-8.16 2.3-6.26 0-11.57-4.22-13.47-9.91l-7.98 6.19C6.51 42.62 14.62 48 24 48z"></path>
                            </svg>
                            <span>Dapatkan Kunci dari Google</span>
                        </a>
                    </div>
                </div>

                <div class="pt-4 border-t border-gray-100">
                    <p class="text-[9px] text-center text-gray-400 leading-relaxed uppercase tracking-widest font-bold">
                        Data Anda aman. API Key disimpan secara lokal di peramban Anda.
                    </p>
                </div>
            </div>
        </div>
    </template>

    <!-- Navigation -->
    <nav class="relative z-20 border-b border-gray-200 glass-effect px-6 py-4">
        <div class="max-w-7xl mx-auto flex items-center justify-between">
            <div class="flex items-center gap-3">
                <div class="flex items-center justify-center w-10 h-10 bg-[#1F1F1F] rounded-xl shadow-lg">
                    <i data-lucide="moon" class="text-white w-5 h-5 fill-current"></i>
                </div>
                <div class="flex flex-col">
                    <span class="font-bold text-2xl tracking-tighter leading-none">LALUNA</span>
                    <span class="text-[9px] font-bold text-gray-400 tracking-[0.3em] mt-0.5 uppercase">Professional AI</span>
                </div>
            </div>
            <div class="flex items-center gap-4">
                <button 
                    @click="resetKey" 
                    class="hidden sm:flex items-center gap-2 px-4 py-2 border border-gray-200 rounded-full text-[10px] font-bold text-gray-500 hover:text-red-500 hover:border-red-100 transition-all uppercase tracking-widest"
                >
                    <i data-lucide="log-out" class="w-3 h-3"></i>
                    Ganti Kunci
                </button>
            </div>
        </div>
    </nav>

    <main class="relative z-10 max-w-6xl mx-auto px-6 py-12 md:py-20">
        
        <!-- Input View -->
        <template x-if="step === 'input'">
            <div class="space-y-12 max-w-4xl mx-auto animate-in fade-in slide-in-from-bottom-4 duration-700">
                <div class="text-center space-y-6">
                    <div class="inline-flex items-center gap-2 px-4 py-1.5 bg-indigo-50 border border-indigo-100 rounded-full text-[10px] font-bold text-indigo-600 uppercase tracking-widest">
                        <i data-lucide="zap" class="w-3 h-3 fill-current"></i> Didukung oleh Imagen 4.0
                    </div>
                    <h1 class="text-5xl md:text-7xl font-extrabold tracking-tight text-[#1F1F1F]">
                        Transformasikan Ide Menjadi <span class="bg-clip-text text-transparent bg-gradient-to-r from-indigo-600 via-purple-600 to-pink-600">Realitas Visual</span>
                    </h1>
                    <p class="text-gray-500 text-lg md:text-xl font-medium max-w-2xl mx-auto leading-relaxed">
                        Generator gambar tingkat profesional untuk kebutuhan komersial dengan aspek rasio sinematik 16:9.
                    </p>
                </div>

                <!-- Error Display -->
                <div x-show="errorMessage" x-transition class="bg-red-50 border border-red-200 text-red-700 px-6 py-4 rounded-[24px] flex items-center gap-3">
                    <i data-lucide="octagon-alert" class="shrink-0 w-5 h-5"></i>
                    <p class="text-sm font-semibold" x-text="errorMessage"></p>
                </div>

                <div class="space-y-6">
                    <div class="bg-white rounded-[40px] border border-gray-200 overflow-hidden shadow-2xl shadow-indigo-100/50 transition-all focus-within:ring-4 focus-within:ring-indigo-50">
                        <textarea
                            x-model="prompt"
                            placeholder="Contoh: Seorang astronot sedang memanen gandum di Mars, pencahayaan golden hour, detail tinggi, sinematik..."
                            class="w-full h-48 bg-transparent p-10 text-xl md:text-2xl outline-none resize-none placeholder:text-gray-300 font-medium leading-relaxed"
                        ></textarea>
                        
                        <div class="px-10 py-6 border-t border-gray-100 bg-gray-50/50 flex flex-col md:flex-row items-center justify-between gap-6">
                            <div class="flex items-center gap-4 w-full md:w-auto overflow-x-auto pb-2 md:pb-0">
                                <template x-for="s in styles" :key="s.id">
                                    <button 
                                        @click="style = s.id"
                                        :class="style === s.id ? 'bg-indigo-600 text-white border-indigo-600' : 'bg-white text-gray-500 border-gray-200 hover:border-indigo-300'"
                                        class="px-5 py-2.5 rounded-full border text-xs font-bold transition-all whitespace-nowrap shadow-sm"
                                        x-text="s.name"
                                    ></button>
                                </template>
                            </div>

                            <button
                                @click="handleGenerate"
                                :disabled="isGenerating || !prompt.trim()"
                                class="w-full md:w-auto flex items-center justify-center gap-4 px-12 py-5 bg-[#1F1F1F] hover:bg-black disabled:bg-gray-200 disabled:text-gray-400 text-white rounded-full font-bold transition-all shadow-xl active:scale-95 group"
                            >
                                <template x-if="isGenerating">
                                    <div class="flex items-center gap-3">
                                        <i data-lucide="loader-2" class="w-5 h-5 animate-spin"></i>
                                        <span>Merender Konsep...</span>
                                    </div>
                                </template>
                                <template x-if="!isGenerating">
                                    <div class="flex items-center gap-3">
                                        <span>Generate Visual</span>
                                        <i data-lucide="sparkles" class="w-5 h-5 group-hover:rotate-12 transition-transform"></i>
                                    </div>
                                </template>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </template>

        <!-- Result View -->
        <template x-if="step === 'result'">
            <div class="space-y-12 animate-in fade-in duration-1000">
                <div class="flex flex-col md:flex-row md:items-center justify-between gap-6 glass-effect p-8 rounded-[32px] border border-gray-200 shadow-sm">
                    <div class="flex items-center gap-6">
                        <button @click="step = 'input'" class="p-4 bg-gray-100 hover:bg-white rounded-2xl transition-all shadow-inner group">
                            <i data-lucide="arrow-left" class="w-6 h-6 text-gray-500 group-hover:text-black"></i>
                        </button>
                        <div>
                            <h2 class="text-3xl font-black tracking-tight">Hasil Studio</h2>
                            <p class="text-gray-500 font-medium">Render visual 1536x864 px telah selesai.</p>
                        </div>
                    </div>
                    <div class="flex gap-3">
                        <span class="px-5 py-2.5 bg-emerald-50 text-emerald-700 border border-emerald-100 rounded-full text-xs font-bold flex items-center gap-2">
                            <i data-lucide="check-check" class="w-4 h-4"></i> High Quality WebP
                        </span>
                    </div>
                </div>

                <div class="grid grid-cols-1 gap-12">
                    <template x-for="(imgUrl, idx) in results" :key="idx">
                        <div class="group bg-white border border-gray-200 rounded-[48px] overflow-hidden shadow-2xl hover:shadow-indigo-200/50 transition-all">
                            <div class="relative aspect-[16/9] w-full bg-gray-100">
                                <img :src="imgUrl" class="w-full h-full object-cover">
                                <div class="absolute inset-0 bg-black/0 group-hover:bg-black/10 transition-colors pointer-events-none"></div>
                                <div class="absolute top-8 left-8">
                                    <div class="px-6 py-2 bg-white/90 backdrop-blur-md rounded-full text-[10px] font-black uppercase tracking-[0.2em] shadow-lg">Aset Ke-<span x-text="idx+1"></span></div>
                                </div>
                            </div>
                            <div class="p-10 flex flex-col md:flex-row justify-between items-center gap-8 bg-white">
                                <div class="space-y-2 text-center md:text-left">
                                    <div class="text-[10px] font-bold text-gray-400 uppercase tracking-widest">Dimensi Pro</div>
                                    <div class="text-2xl font-bold tracking-tight">1536 Ã— 864 <span class="text-gray-300 font-normal">Pixel</span></div>
                                </div>
                                <div class="flex w-full md:w-auto gap-4">
                                    <button 
                                        @click="handleDownload(imgUrl, idx)"
                                        class="flex-1 md:flex-none flex items-center justify-center gap-3 px-12 py-5 bg-indigo-600 hover:bg-indigo-700 text-white rounded-[24px] font-bold shadow-xl shadow-indigo-200 transition-all active:scale-95"
                                    >
                                        <i data-lucide="download" class="w-5 h-5"></i>
                                        <span>Download Aset</span>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </template>
                </div>
                
                <button @click="step = 'input'" class="w-full py-16 border-4 border-dashed border-gray-200 rounded-[48px] flex flex-col items-center gap-4 text-gray-300 hover:text-indigo-600 hover:border-indigo-100 hover:bg-indigo-50/30 transition-all group">
                    <div class="p-5 bg-gray-100 rounded-full group-hover:bg-white shadow-sm transition-all">
                        <i data-lucide="plus" class="w-8 h-8"></i>
                    </div>
                    <span class="font-black uppercase tracking-widest text-sm">Buat Eksplorasi Baru</span>
                </button>
            </div>
        </template>
    </main>

    <footer class="py-12 border-t border-gray-100 text-center">
        <p class="text-[10px] font-bold text-gray-400 uppercase tracking-widest">LALUNA STUDIO â€¢ KREATIFITAS TANPA BATAS â€¢ 2024</p>
    </footer>

    <script>
        function app() {
            return {
                apiKey: '',
                apiKeyConfigured: false,
                tempKey: '',
                prompt: '',
                style: 'photographic',
                isGenerating: false,
                results: [],
                step: 'input',
                errorMessage: '',
                styles: [
                    { id: 'photographic', name: 'ðŸ“¸ Fotografi', suffix: "professional commercial photography, 8k, ultra-hd, sharp focus, masterpiece" },
                    { id: 'cinematic', name: 'ðŸŽ¬ Sinematik', suffix: "cinematic film still, anamorphic lens, epic lighting, highly detailed" },
                    { id: 'illustrative', name: 'ðŸŽ¨ Ilustrasi', suffix: "clean modern digital illustration, vector style, artistic, high resolution" },
                    { id: 'architecture', name: 'ðŸ›ï¸ Arsitektur', suffix: "modern architectural visualization, photorealistic, twilight lighting, clean lines" }
                ],
                init() {
                    const saved = localStorage.getItem('laluna_pro_key');
                    if (saved) {
                        this.apiKey = saved;
                        this.apiKeyConfigured = true;
                    }
                    this.$nextTick(() => lucide.createIcons());
                },
                saveKey() {
                    if (this.tempKey.trim().length > 10) {
                        this.apiKey = this.tempKey.trim();
                        localStorage.setItem('laluna_pro_key', this.apiKey);
                        this.apiKeyConfigured = true;
                        this.$nextTick(() => lucide.createIcons());
                    }
                },
                resetKey() {
                    if(confirm("Apakah Anda ingin mengganti API Key?")) {
                        localStorage.removeItem('laluna_pro_key');
                        this.apiKeyConfigured = false;
                        this.apiKey = '';
                        this.tempKey = '';
                        this.$nextTick(() => lucide.createIcons());
                    }
                },
                async handleGenerate() {
                    if (!this.prompt.trim()) return;
                    
                    this.isGenerating = true;
                    this.errorMessage = '';
                    const selectedStyle = this.styles.find(s => s.id === this.style);
                    
                    try {
                        const imgBase64 = await this.callImagen(this.prompt, selectedStyle.suffix);
                        const processed = await this.processImage(imgBase64);
                        this.results = [processed];
                        this.step = 'result';
                    } catch (err) {
                        this.errorMessage = err.message || "Gagal menghubungi AI. Periksa API Key atau koneksi Anda.";
                    } finally {
                        this.isGenerating = false;
                        this.$nextTick(() => lucide.createIcons());
                    }
                },
                async callImagen(prompt, suffix) {
                    const url = `https://generativelanguage.googleapis.com/v1beta/models/imagen-4.0-generate-001:predict?key=${this.apiKey}`;
                    
                    const response = await fetch(url, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            instances: [{ prompt: `${prompt}, ${suffix}. cinematic 16:9 ratio.` }],
                            parameters: { sampleCount: 1 }
                        })
                    });

                    if (!response.ok) {
                        const errorData = await response.json().catch(() => ({}));
                        throw new Error(errorData.error?.message || "Kunci API tidak valid atau limit terlampaui.");
                    }

                    const data = await response.json();
                    return `data:image/png;base64,${data.predictions[0].bytesBase64Encoded}`;
                },
                processImage(base64) {
                    return new Promise(resolve => {
                        const img = new Image();
                        img.onload = () => {
                            const canvas = document.createElement('canvas');
                            canvas.width = 1536; canvas.height = 864;
                            const ctx = canvas.getContext('2d');
                            
                            // Fit and cover logic
                            const targetRatio = 1536/864;
                            const imgRatio = img.width / img.height;
                            let sw, sh, sx, sy;
                            
                            if (imgRatio > targetRatio) {
                                sh = img.height; sw = img.height * targetRatio;
                                sx = (img.width - sw) / 2; sy = 0;
                            } else {
                                sw = img.width; sh = img.width / targetRatio;
                                sx = 0; sy = (img.height - sh) / 2;
                            }

                            ctx.drawImage(img, sx, sy, sw, sh, 0, 0, 1536, 864);
                            resolve(canvas.toDataURL('image/webp', 0.92));
                        };
                        img.src = base64;
                    });
                },
                handleDownload(url, i) {
                    const link = document.createElement('a');
                    link.href = url;
                    link.download = `LALUNA-RENDER-${Date.now()}.webp`;
                    link.click();
                }
            }
        }
    </script>
    <script src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js"></script>
</body>
</html>
