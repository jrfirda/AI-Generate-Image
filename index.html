<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LALUNA Studio AI - Profesional Visual Generator</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        body { font-family: 'Plus Jakarta Sans', sans-serif; }
        [x-cloak] { display: none !important; }
        input[type='range']::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            background: #4285F4;
            cursor: pointer;
            border-radius: 50%;
            border: 3px solid white;
            box-shadow: 0 2px 10px rgba(66, 133, 244, 0.4);
        }
    </style>
</head>
<body class="bg-[#F8FAFD] text-[#1F1F1F] selection:bg-[#4285F4]/20" x-data="app()" x-init="init()" x-cloak>
    
    <!-- Background Decor -->
    <div class="fixed inset-0 overflow-hidden pointer-events-none">
        <div class="absolute top-[-10%] right-[-5%] w-[40%] h-[40%] bg-[#4285F4]/5 blur-[100px] rounded-full"></div>
        <div class="absolute bottom-[-5%] left-[-5%] w-[40%] h-[40%] bg-[#9B72F3]/5 blur-[100px] rounded-full"></div>
    </div>

    <!-- Navigation -->
    <nav class="relative z-20 border-b border-gray-200 bg-white/80 backdrop-blur-md px-6 py-4">
        <div class="max-w-7xl mx-auto flex items-center justify-between">
            <div class="flex items-center gap-3">
                <div class="flex items-center justify-center w-9 h-9 bg-[#1F1F1F] rounded-lg">
                    <i data-lucide="moon" class="text-white w-5 h-5 fill-current"></i>
                </div>
                <div class="flex flex-col">
                    <span class="font-bold text-xl tracking-tight text-[#1F1F1F] leading-none">LALUNA</span>
                    <span class="text-[9px] font-bold text-gray-400 tracking-[0.2em] mt-0.5 uppercase">Studio AI</span>
                </div>
            </div>
            <div class="flex items-center gap-4">
                <div class="hidden sm:flex items-center gap-2 px-3 py-1.5 bg-gray-100 rounded-full border border-gray-200 text-[10px] font-bold tracking-widest text-gray-500 uppercase">
                   Imagen 4.0 Wide
                </div>
            </div>
        </div>
    </nav>

    <main class="relative z-10 max-w-6xl mx-auto px-6 py-12">
        
        <!-- Input Step -->
        <template x-if="step === 'input'">
            <div class="space-y-12 max-w-4xl mx-auto animate-in fade-in duration-500">
                <div class="text-center space-y-4">
                    <h1 class="text-4xl md:text-6xl font-bold tracking-tight text-[#1F1F1F]">
                        Transformasi Ide ke <span class="bg-clip-text text-transparent bg-gradient-to-r from-[#4285F4] via-[#9B72F3] to-[#D96570]">Eksplorasi Visual</span>
                    </h1>
                    <p class="text-gray-500 text-lg font-medium max-w-2xl mx-auto">
                        Platform generasi gambar mutakhir untuk menghasilkan aset sinematik 1536x864 (16:9) dengan standar industri dan format WebP teroptimasi.
                    </p>
                </div>

                <!-- Error Message -->
                <div x-show="errorMessage" x-transition class="bg-red-50 border border-red-200 text-red-700 px-6 py-4 rounded-2xl flex items-center gap-3">
                    <i data-lucide="alert-circle" class="shrink-0 w-5 h-5"></i>
                    <p class="text-sm font-medium" x-text="errorMessage"></p>
                </div>

                <div class="space-y-6">
                    <div class="relative group">
                        <div class="absolute -inset-1 bg-gradient-to-r from-[#4285F4]/20 to-[#9B72F3]/20 rounded-[32px] blur-md opacity-0 group-focus-within:opacity-100 transition duration-500"></div>
                        <div class="relative bg-white rounded-[28px] border border-gray-200 overflow-hidden shadow-xl shadow-gray-200/50">
                            <textarea
                                x-model="prompt"
                                placeholder="Deskripsikan konsep visual yang ingin Anda wujudkan secara detail..."
                                class="w-full h-48 bg-transparent p-8 text-xl text-[#1F1F1F] outline-none resize-none placeholder:text-gray-400 font-light leading-relaxed"
                            ></textarea>
                            <div class="px-8 py-5 border-t border-gray-100 bg-gray-50/50 flex items-center justify-between">
                                <div class="flex gap-3">
                                    <button class="p-2.5 hover:bg-gray-200 rounded-full text-gray-500 transition-colors"><i data-lucide="image" class="w-5 h-5"></i></button>
                                    <button class="p-2.5 hover:bg-gray-200 rounded-full text-gray-500 transition-colors"><i data-lucide="sparkles" class="w-5 h-5"></i></button>
                                </div>
                                <button
                                    @click="handleGenerate"
                                    :disabled="isGenerating || !prompt.trim()"
                                    class="flex items-center gap-3 px-10 py-3.5 bg-[#1F1F1F] hover:bg-[#333] disabled:bg-gray-200 disabled:text-gray-400 rounded-full font-bold text-white transition-all shadow-lg hover:shadow-xl active:scale-95"
                                >
                                    <template x-if="isGenerating">
                                        <div class="flex items-center gap-2">
                                            <i data-lucide="loader-2" class="animate-spin w-5 h-5"></i>
                                            <span>Memproses...</span>
                                        </div>
                                    </template>
                                    <template x-if="!isGenerating">
                                        <div class="flex items-center gap-2">
                                            <span>Generate Visual</span>
                                            <i data-lucide="arrow-right" class="w-4 h-4"></i>
                                        </div>
                                    </template>
                                </button>
                            </div>
                        </div>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-12 gap-6">
                        <div class="md:col-span-8 bg-white border border-gray-200 rounded-[28px] p-8 shadow-sm">
                            <h3 class="text-sm font-bold text-gray-400 mb-5 flex items-center gap-2 uppercase tracking-widest">
                                <i data-lucide="palette" class="w-4 h-4"></i> Pilih Gaya Visual
                            </h3>
                            <div class="grid grid-cols-1 sm:grid-cols-3 gap-4">
                                <template x-for="s in styles" :key="s.id">
                                    <button
                                        @click="style = s.id"
                                        :class="style === s.id ? 'bg-[#4285F4]/5 border-[#4285F4] text-[#4285F4]' : 'bg-white border-gray-100 hover:border-gray-300 text-gray-500'"
                                        class="flex flex-col items-center justify-center p-5 rounded-2xl border-2 transition-all text-center gap-3"
                                    >
                                        <div :class="style === s.id ? 'bg-[#4285F4] text-white' : 'bg-gray-100'" class="p-3 rounded-xl transition-colors">
                                            <i :data-lucide="s.icon" class="w-5 h-5"></i>
                                        </div>
                                        <span class="text-sm font-bold tracking-tight" x-text="s.name"></span>
                                    </button>
                                </template>
                            </div>
                        </div>

                        <div class="md:col-span-4 bg-white border border-gray-200 rounded-[28px] p-8 shadow-sm space-y-8">
                            <div class="space-y-4">
                                <div class="flex justify-between items-center">
                                    <span class="text-xs font-bold text-gray-400 uppercase tracking-widest flex items-center gap-1"><i data-lucide="settings" class="w-3.5 h-3.5"></i> Kualitas</span>
                                    <span class="text-[#4285F4] font-mono font-bold" x-text="Math.round(compression * 100) + '%'"></span>
                                </div>
                                <input
                                    type="range"
                                    min="0.1"
                                    max="1.0"
                                    step="0.05"
                                    x-model="compression"
                                    class="w-full accent-[#4285F4] h-2 bg-gray-100 rounded-full appearance-none cursor-pointer"
                                />
                            </div>
                            
                            <div class="p-4 bg-gray-50 rounded-2xl border border-gray-100 space-y-3">
                                <div class="flex items-center gap-2 text-[10px] font-bold text-gray-400 uppercase tracking-tighter">
                                    <i data-lucide="monitor" class="text-[#4285F4] w-3.5 h-3.5"></i> Resolusi Native
                                </div>
                                <div class="text-lg text-[#1F1F1F] font-bold">1536 × 864 <span class="text-xs font-normal text-gray-400 ml-1">PX</span></div>
                                <div class="flex items-center gap-1.5 text-[10px] text-emerald-600 font-bold bg-emerald-50 w-fit px-2 py-0.5 rounded-md">
                                    <i data-lucide="check-circle-2" class="w-2.5 h-2.5"></i> 16:9 WIDESCREEN
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </template>

        <!-- Result Step -->
        <template x-if="step === 'result'">
            <div class="space-y-10 animate-in fade-in duration-700">
                <div class="flex flex-col md:flex-row md:items-center justify-between gap-6 bg-white p-6 rounded-[24px] border border-gray-200 shadow-sm">
                    <div class="flex items-center gap-4">
                        <button 
                            @click="step = 'input'"
                            class="p-3 bg-gray-100 hover:bg-gray-200 rounded-full transition-colors text-gray-600"
                        >
                            <i data-lucide="refresh-cw" class="w-5 h-5"></i>
                        </button>
                        <div>
                            <h2 class="text-2xl font-bold text-[#1F1F1F]">Hasil Render Laluna</h2>
                            <p class="text-sm text-gray-500 font-medium">Aset visual Anda telah berhasil dirender sempurna.</p>
                        </div>
                    </div>
                    <div class="text-xs text-indigo-600 font-bold bg-indigo-50 px-4 py-2 rounded-full flex items-center gap-2 border border-indigo-100">
                        <i data-lucide="info" class="w-3.5 h-3.5"></i> Resolusi 1536x864 Teroptimalisasi
                    </div>
                </div>

                <div class="grid grid-cols-1 gap-8">
                    <template x-for="(imgUrl, idx) in results" :key="idx">
                        <div class="bg-white border border-gray-200 rounded-[32px] overflow-hidden group shadow-xl shadow-gray-200/40 transition-all hover:shadow-2xl max-w-5xl mx-auto w-full">
                            <div class="relative aspect-[16/9] w-full bg-gray-100 overflow-hidden">
                                <img 
                                    :src="imgUrl" 
                                    class="w-full h-full object-cover transition duration-700 group-hover:scale-[1.02]"
                                />
                                <div class="absolute top-6 left-6">
                                   <span class="px-5 py-2 bg-white/90 backdrop-blur-sm border border-gray-100 rounded-full text-[11px] font-bold tracking-[0.1em] uppercase text-gray-800 shadow-sm" x-text="'Varian ' + (idx + 1)"></span>
                                </div>
                            </div>
                            <div class="p-8 flex flex-col md:flex-row justify-between items-center gap-6">
                                <div class="space-y-1 text-center md:text-left">
                                    <div class="text-sm font-bold text-gray-400 uppercase tracking-widest font-mono">
                                        WebP • 1536 x 864
                                    </div>
                                    <div class="text-xl font-bold text-[#1F1F1F]" x-text="'Aset Kreatif ' + (idx + 1)"></div>
                                </div>
                                <button
                                    @click="handleDownload(imgUrl, idx)"
                                    class="w-full md:w-auto px-10 py-4 bg-[#4285F4] hover:bg-[#3b78db] text-white rounded-2xl font-bold transition-all shadow-lg shadow-[#4285F4]/30 flex items-center justify-center gap-3"
                                >
                                    <i data-lucide="download" class="w-5 h-5"></i>
                                    Simpan Aset
                                </button>
                            </div>
                        </div>
                    </template>
                </div>

                <button
                    @click="step = 'input'"
                    class="w-full py-10 border-2 border-dashed border-gray-200 rounded-[32px] text-gray-400 hover:text-[#4285F4] hover:border-[#4285F4]/40 hover:bg-[#4285F4]/5 transition-all flex flex-col items-center gap-3 group"
                >
                    <div class="p-4 bg-gray-100 rounded-full group-hover:bg-white transition-colors shadow-sm">
                       <i data-lucide="refresh-cw" class="w-6 h-6"></i>
                    </div>
                    <span class="font-bold tracking-wide uppercase text-xs">Mulai Konsep Baru</span>
                </button>
            </div>
        </template>

        <footer class="mt-20 text-center space-y-6">
           <div class="h-px w-full bg-gradient-to-r from-transparent via-gray-200 to-transparent"></div>
           <div class="flex flex-col md:flex-row justify-center items-center gap-6">
              <div class="flex items-center gap-2">
                <i data-lucide="moon" class="w-3.5 h-3.5 text-[#1F1F1F] fill-current"></i>
                <span class="text-[10px] font-bold text-[#1F1F1F] tracking-[0.3em] uppercase">LALUNA STUDIO</span>
              </div>
              <div class="flex gap-8 text-gray-400">
                <span class="text-[10px] uppercase tracking-widest font-bold hover:text-gray-600 cursor-pointer transition-colors">Documentation</span>
                <span class="text-[10px] uppercase tracking-widest font-bold hover:text-gray-600 cursor-pointer transition-colors">API Status</span>
                <span class="text-[10px] uppercase tracking-widest font-bold">Imagen 4.0 Pro</span>
              </div>
           </div>
           <p class="text-gray-400 text-[10px] font-medium uppercase tracking-tight">
            © 2024 LALUNA CREATIVE • KECERDASAN BUATAN UNTUK VISUALISASI PROFESIONAL.
           </p>
        </footer>
    </main>

    <script>
        function app() {
            return {
                // Untuk keamanan di Vercel, kita akan menggunakan deteksi URL params atau manual input
                // Jika ingin benar-benar otomatis di Vercel, cara paling umum adalah mengisi string kosong 
                // dan meminta user memasukkannya via UI, atau mengisinya sebelum push.
                apiKey: "GEMINI_API_KEY", 
                prompt: '',
                style: 'photographic',
                compression: 0.85,
                isGenerating: false,
                results: [],
                step: 'input',
                errorMessage: '',
                styles: [
                    { id: 'photographic', name: 'Fotografi', icon: 'camera', promptSuffix: "professional commercial photography, 8k, sharp focus, high-end camera, masterpiece" },
                    { id: 'illustrative', name: 'Ilustrasi', icon: 'palette', promptSuffix: "clean modern digital illustration, flat design, artistic, high resolution, soft colors" },
                    { id: 'realistic', name: 'Realistis', icon: 'layers', promptSuffix: "hyper-realistic, cinematic lighting, 8k octane render, extremely detailed" }
                ],
                init() {
                    lucide.createIcons();
                    this.$watch('step', () => {
                        this.$nextTick(() => lucide.createIcons());
                    });
                },
                async handleGenerate() {
                    // Validasi API Key sebelum generate
                    if (!this.apiKey || this.apiKey.length < 10) {
                        this.errorMessage = "API Key tidak valid atau belum diisi. Masukkan API Key Gemini Anda di file index.html.";
                        return;
                    }

                    if (!this.prompt.trim()) return;
                    this.isGenerating = true;
                    this.results = [];
                    this.errorMessage = '';

                    const selectedStyle = this.styles.find(s => s.id === this.style);

                    try {
                        const rawImages = [];
                        const img1 = await this.generateSingleImage(this.prompt, selectedStyle.promptSuffix);
                        rawImages.push(img1);
                        await new Promise(r => setTimeout(r, 500));
                        const img2 = await this.generateSingleImage(this.prompt, selectedStyle.promptSuffix);
                        rawImages.push(img2);

                        const processedImages = await Promise.all(
                            rawImages.map(img => img ? this.processImage(img) : null)
                        );

                        this.results = processedImages.filter(img => img !== null);
                        if (this.results.length === 0) throw new Error("Gagal memproses gambar.");
                        this.step = 'result';
                    } catch (err) {
                        console.error(err);
                        this.errorMessage = err.message || "Terjadi kesalahan sistem AI. Coba lagi.";
                    } finally {
                        this.isGenerating = false;
                        this.$nextTick(() => lucide.createIcons());
                    }
                },
                async generateSingleImage(userPrompt, styleSuffix, retries = 5) {
                    const fullPrompt = `${userPrompt}, ${styleSuffix}. Cinematic widescreen shot, 16:9 aspect ratio, high definition.`;
                    for (let i = 0; i < retries; i++) {
                        try {
                            const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/imagen-4.0-generate-001:predict?key=${this.apiKey}`, {
                                method: 'POST',
                                headers: { 'Content-Type': 'application/json' },
                                body: JSON.stringify({
                                    instances: [{ prompt: fullPrompt }],
                                    parameters: { sampleCount: 1 }
                                })
                            });
                            if (!response.ok) {
                                const errorData = await response.json().catch(() => ({}));
                                throw new Error(errorData.error?.message || `API Error ${response.status}`);
                            }
                            const data = await response.json();
                            return `data:image/png;base64,${data.predictions[0].bytesBase64Encoded}`;
                        } catch (error) {
                            if (i === retries - 1) throw error;
                            await new Promise(r => setTimeout(r, Math.pow(2, i) * 1000));
                        }
                    }
                },
                processImage(base64Str) {
                    return new Promise((resolve) => {
                        const img = new Image();
                        img.onload = () => {
                            const canvas = document.createElement('canvas');
                            canvas.width = 1536;
                            canvas.height = 864;
                            const ctx = canvas.getContext('2d');
                            const targetRatio = 1536 / 864;
                            const imgRatio = img.width / img.height;
                            let drawWidth, drawHeight, offsetX, offsetY;
                            if (imgRatio > targetRatio) {
                                drawHeight = img.height;
                                drawWidth = img.height * targetRatio;
                                offsetX = (img.width - drawWidth) / 2;
                                offsetY = 0;
                            } else {
                                drawWidth = img.width;
                                drawHeight = img.width / targetRatio;
                                offsetX = 0;
                                offsetY = (img.height - drawHeight) / 2;
                            }
                            ctx.drawImage(img, offsetX, offsetY, drawWidth, drawHeight, 0, 0, 1536, 864);
                            resolve(canvas.toDataURL('image/webp', parseFloat(this.compression)));
                        };
                        img.src = base64Str;
                    });
                },
                handleDownload(url, index) {
                    const link = document.createElement('a');
                    link.href = url;
                    link.download = `LALUNA-Export-${index + 1}.webp`;
                    document.body.appendChild(link);
                    link.click();
                    document.body.removeChild(link);
                }
            }
        }
    </script>
    <script src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js"></script>
</body>
</html>
